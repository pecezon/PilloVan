generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ROLE {
  TOURIST
  WORKER
  COMPANY
  ADMIN
}

enum GENDER {
  MALE
  FEMALE
  OTHER
}

enum STATUS {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model users {
  auth_id            String @id @unique
  firstName          String?
  lastName           String?
  phone              String?
  phoneAlt           String?
  email              String? @unique
  age                Int?
  whapi_id           String? @unique
  gender             GENDER?
  role               ROLE @default(TOURIST)
  finishedOnboarding Boolean @default(false)
  createdAt          DateTime @default(now())
  tours              Tour[]
  tripRoles          TripUsers[]
}

model Tour {
  id          Int     @id @default(autoincrement())
  name        String
  place       String
  occupancy   Int
  description String?

  companyId String
  company   users @relation(fields: [companyId], references: [auth_id])

  trips Trip[]
}

model Trip {
  id Int @id @default(autoincrement())

  tourId Int
  tour   Tour @relation(fields: [tourId], references: [id])

  pickup_time         DateTime
  whatsApp_group_link String?
  party_size          Int
  pickup_location     String
  dropoff_location    String
  status              STATUS   @default(PENDING)

  users TripUsers[]
}

model TripUsers {
  tripId Int
  userId String
  role   ROLE?

  trip Trip  @relation(fields: [tripId], references: [id])
  user users @relation(fields: [userId], references: [auth_id])

  @@id([tripId, userId])
}
